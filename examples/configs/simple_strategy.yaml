# =============================================================================
# Simple Strategy Configuration
# =============================================================================
#
# This configuration demonstrates a basic single-asset strategy with:
# - Simple time-based exit (60 bars)
# - Fixed stop loss (2%)
# - No ML signals, just price-based rules
#
# Use Case: Learning the config system, testing basic execution logic
# Expected Runtime: <1 second
# =============================================================================

# Optional metadata for identification
name: "Simple Moving Average Strategy"
description: "Basic single-asset strategy with time-based and stop-loss exits"

# -----------------------------------------------------------------------------
# Data Sources
# -----------------------------------------------------------------------------
# All data must be in Parquet, CSV, or HDF5 format
# Paths support environment variable expansion: ${VAR_NAME}
# All paths are validated on load (file must exist)

data_sources:
  # REQUIRED: Price data (OHLCV bars)
  # Must contain: timestamp, asset_id, open, high, low, close, volume
  prices:
    path: "examples/integrated/data/stock_data.parquet"
    format: parquet  # Options: parquet, csv, hdf5
    timestamp_column: timestamp  # Default: timestamp
    asset_column: asset_id  # Default: asset_id
    # Optional: Load only specific columns (saves memory)
    # columns: [timestamp, asset_id, open, high, low, close, volume]
    # Optional: Filter data before loading
    # filters: ["asset_id == 'STOCK000'"]

  # OPTIONAL: ML signals (not used in this simple example)
  # signals: null

  # OPTIONAL: Precomputed features (not used in this simple example)
  # features: null

  # OPTIONAL: Market context data (VIX, SPY, etc.)
  # context: null

# -----------------------------------------------------------------------------
# Feature Provider (Optional)
# -----------------------------------------------------------------------------
# Two types: precomputed (from file) or callable (Python function)
# Not used in this simple example - we only use price data

features: null

# Alternative: Precomputed features from file
# features:
#   type: precomputed
#   path: "data/features.parquet"
#   columns: [atr, rsi, volatility]  # Optional: specific columns
#   timestamp_column: timestamp
#   asset_column: asset_id

# Alternative: Callable feature provider
# features:
#   type: callable
#   module: my_features  # Python module to import
#   function: compute_features  # Function name
#   kwargs:  # Optional kwargs passed to function
#     lookback: 20
#     indicators: [rsi, macd]

# -----------------------------------------------------------------------------
# Risk Rules (Optional but Recommended)
# -----------------------------------------------------------------------------
# Define exit conditions for open positions
# All rules are optional - specify only what you need

risk_rules:
  # Maximum position size as fraction of portfolio value
  # 0.1 = 10% of NAV per position
  max_position_size: 0.2

  # Stop loss: Exit if price drops X% from entry
  # 0.02 = 2% stop loss
  stop_loss: 0.02

  # Take profit: Exit if price rises X% from entry (optional)
  # take_profit: 0.05  # 5% take profit

  # Maximum portfolio risk (heat) as fraction of NAV
  # Example: 0.06 = max 6% of NAV at risk across all positions
  # max_portfolio_heat: 0.06

  # VIX-based trading filters (requires context data)
  # Only trade when VIX is in this range
  # min_vix: 10.0  # Don't trade if VIX < 10 (too quiet)
  # max_vix: 30.0  # Don't trade if VIX > 30 (too volatile)

# -----------------------------------------------------------------------------
# Execution Parameters
# -----------------------------------------------------------------------------
# Configure broker simulation, costs, and execution behavior

execution:
  # Starting cash amount
  initial_capital: 100000.0

  # Commission model
  commission:
    type: per_share  # Options: per_share, percentage, fixed, tiered
    rate: 0.005  # $0.005 per share (Interactive Brokers typical)
    minimum: 1.0  # Minimum commission per trade

  # Slippage model (market impact)
  slippage:
    type: percentage  # Options: fixed, percentage, volume_share
    rate: 0.001  # 0.1% slippage (10 bps)

  # Margin trading (not recommended for beginners)
  enable_margin: false
  max_leverage: 1.0  # 1.0 = no leverage, 2.0 = 2Ã— leverage

  # Execution delay: Prevent lookahead bias by delaying fills to next bar
  # TRUE (recommended): Orders submitted on bar N fill at bar N+1 open
  # FALSE (dangerous): Orders fill immediately on current bar (lookahead bias)
  execution_delay: true

  # Allow immediate re-entry on same bar as exit
  # TRUE: Can exit position and re-enter on same bar
  # FALSE: Must wait for next bar after exit
  allow_immediate_reentry: true

# =============================================================================
# Usage Instructions
# =============================================================================
#
# 1. Save this file as: examples/configs/simple_strategy.yaml
#
# 2. Load and validate:
#    ```python
#    from pathlib import Path
#    from ml4t.backtest.config import BacktestConfig
#
#    config = BacktestConfig.from_yaml(Path("examples/configs/simple_strategy.yaml"))
#    print(config.execution.initial_capital)  # 100000.0
#    ```
#
# 3. Use with backtest engine:
#    ```python
#    from ml4t.backtest.engine import BacktestEngine
#
#    engine = BacktestEngine.from_config(config)
#    results = engine.run()
#    ```
#
# 4. Common modifications:
#    - Change stop_loss to 0.01 for tighter 1% stop
#    - Add take_profit: 0.05 for 5% profit targets
#    - Increase initial_capital to 1000000.0 for larger backtest
#    - Set execution_delay: false to test lookahead bias impact
#
# =============================================================================
